# Mineru2Questions 项目回归评审报告 (v2.0) - 修复回复

## 1. 概览

针对 v2.0 评审报告中提出的建议，已完成核心修复工作。重点解决了 LLM 注意力衰减导致的内容遗漏问题（P1），并优化了章节标题提取逻辑（P2）。

## 2. 修复详情

### 2.1 【P1-立即修复】LLM 调用重试机制与健全性检查

**状态**：✅ **已完成**

**修改文件**：`server/extraction.ts`

**实施方案**：
1.  **集成 `axios-retry`**：
    -   引入 `axios-retry` 库。
    -   配置全局重试策略：`retries: 3`，使用指数退避（Exponential Backoff）算法，针对网络错误和 5xx 状态码自动重试。
2.  **实现健全性检查 (Sanity Check)**：
    -   在 Worker 处理循环中增加逻辑判断：
        -   **触发条件**：Chunk 输入 Blocks 数量 > 40 且 LLM 输出题目数量 <= 1。
        -   **处理动作**：若满足条件且未达到最大重试次数，主动抛出异常 `Sanity Check Failed`。
        -   **重试机制**：Worker 捕获异常后，会等待一段时间（指数递增）并重新处理该 Chunk。
    -   **预期效果**：有效挽回因 LLM 随机性或注意力衰减导致的“大块内容丢失”问题。

### 2.2 【P2-择机优化】章节标题提取逻辑

**状态**：✅ **已完成**

**修改文件**：`server/prompts.ts`

**实施方案**：
1.  **优化 Prompt 指令**：
    -   明确要求优先使用带有数字编号的标题（如 "19.1", "第1章"）。
    -   扩充黑名单，明确排除 "选择题", "填空题" 等非章节性标题。
    -   增加“不确定则不标记”的保守策略，减少噪声。

## 3. 验证建议

建议重新运行完整提取任务，重点关注之前出现遗漏的页面（如 P8, P76-82 等），验证覆盖率是否提升。同时观察日志中是否有 `Sanity Check Failed` 的警告及其后续的重试成功记录。
