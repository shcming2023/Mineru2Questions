# 🧪 手动测试快速指导卡片

**当前页面**: http://localhost:3000  
**测试目标**: 验证 P0-002 修复（章节预处理失败不降级）

---

## ⭐ 测试3：章节预处理失败场景验证（核心测试）

### 📝 测试步骤

#### 第1步：配置错误的LLM（3分钟）

1. 点击左侧导航栏 **"设置"** 或访问 http://localhost:3000/settings
2. 点击 **"新建配置"** 或 **"添加LLM配置"** 按钮
3. 填写以下信息：

```
配置名称:     测试-故意失败LLM
预设提供商:   自定义 API
API URL:      https://api.example.com/v1
API Key:      invalid-key-for-testing
模型名称:     test-model
用途:         长文本推理 (long_context)
并发数:       5
超时时间:     120 秒
```

4. 点击 **"保存"** （无需点击"测试连接"）

---

#### 第2步：创建测试任务（2分钟）

1. 点击左侧导航栏 **"新建任务"** 或访问 http://localhost:3000/tasks/new
2. 填写任务信息：

```
任务名称: 失败场景测试-P0-002验证
```

3. **上传文件**：
   - 如果有现成的测试文件，上传即可
   - 如果没有，可以使用 `server/uploads/tasks/` 下已有的任务文件

4. **LLM配置**：
   - 章节预处理模型：选择 **"测试-故意失败LLM"**
   - 题目抽取模型：选择任意可用模型（或也选错误LLM）

5. 点击 **"创建任务"**

---

#### 第3步：观察任务执行（2分钟）

1. 创建后会自动跳转到任务详情页
2. 观察 **"实时日志区"** 的输出

---

### ✅ 预期结果（修复后的正确行为）

#### 日志输出应包含：
```
[INFO] 开始章节预处理（零筛选全文推理 + 两轮 LLM 校验）...
[ERROR] 章节预处理失败，任务终止: <错误信息>
```

#### 任务状态应为：
- ❌ **状态徽标**: 红色 - "失败" (failed)
- ❌ **不应该是**: 绿色 - "已完成" (completed)

#### 关键检查点：
- ✅ 日志中包含 **"任务终止"** 字样
- ✅ 日志级别为 **[ERROR]**（不是 [WARN]）
- ✅ 日志中 **不包含** "降级" 或 "回退" 字样
- ✅ 任务在章节预处理阶段停止（未进入题目抽取阶段）
- ✅ 未生成 `results/questions.json` 文件

---

### ❌ 错误的行为（如果出现说明修复失败）

如果看到以下情况，说明修复未生效：

```
❌ 日志显示: [WARN] 章节预处理失败（将降级使用题目抽取阶段的章节信息）
❌ 任务继续执行，进入题目抽取阶段
❌ 最终任务状态 = completed（已完成）
❌ 生成了 questions.json 但题目没有章节信息
```

---

## 📋 可选测试：测试2 正常流程验证

如果你有可用的LLM配置（如DeepSeek、Gemini等），可以额外测试正常流程：

### 步骤：
1. 在"设置"中确保有一个有效的长文本推理LLM
2. 创建新任务，选择有效的LLM
3. 上传测试文件并启动

### 预期结果：
- ✅ 日志显示 **"零筛选全文推理 + 两轮 LLM 校验"**
- ✅ 不显示 **"三轨混合架构"** 或 **"V2"** 字样
- ✅ 生成 `debug/chapter_flat_map.json`
- ✅ 任务成功完成，生成 `results/questions.json`

---

## 🐛 如果发现问题

### 记录以下信息：
1. 任务ID
2. 完整的日志输出（复制粘贴）
3. 任务最终状态（failed/completed）
4. 是否生成了结果文件

### 报告位置：
- 在 `docs/验证测试计划_2026-02-21.md` 中的"问题记录模板"填写
- 或直接告诉我，我会协助分析

---

## ✅ 测试通过标准

**最小验收**：
- [x] 测试3通过（失败场景验证）
  - [x] 任务状态 = failed
  - [x] 日志包含"任务终止"
  - [x] 未降级执行

**建议通过后立即提交代码到远程仓库！**

---

## 📞 需要帮助？

如果测试过程中遇到任何问题或疑问，随时告诉我：
- 截图或复制日志输出
- 描述实际看到的行为
- 我会协助分析和解决

---

**祝测试顺利！** 🚀

现在就可以开始在左侧浏览器窗口中进行测试了。
