# Mineru2Questions 项目回归评审报告 (v1.6)

**日期**: 2026-02-10
**Commit**: `c5a3e1b`

## 1. 核心结论

本次修订**测试成功**。系统核心功能已恢复，阻塞性缺陷已修复，性能问题得到解决。最新测试任务 (`202602092127`) 成功产出 **851** 道题目，并发性能恢复至 **6.4x** 加速，接近理论值。

然而，在产出结果中发现了 **2 个新的 Bug** 和 **5 个数据质量与健全性问题**。我们建议在庆祝本次里程碑式进展的同时，立即着手修复这些新问题，以提升产出质量和系统可维护性。

| 类别 | 状态 | 摘要 |
| :--- | :--- | :--- |
| **核心功能** | <font color="green">**已修复**</font> | 系统成功运行，产出 851 道题目，此前为 0 题。 |
| **并发性能** | <font color="green">**已修复**</font> | `Promise.all` 并发机制恢复，耗时从串行的 15.5 分钟降至 **2.4 分钟**。 |
| **数据质量** | <font color="orange">**存在差距**</font> | 发现重复题目、章节标题噪声、子题拆分不当、答案覆盖率低等问题。 |
| **系统健全性** | <font color="red">**存在缺陷**</font> | 发现 `extractedCount` 未更新、日志被忽略、图片路径不可移植等 Bug。 |

---

## 2. 回归测试与修复验证

### 2.1. 测试任务概览

| 指标 | 结果 |
| :--- | :--- |
| **任务 ID** | `202602092127-1770643685096` |
| **输入文档** | 八年级上册数学练习册 (PDF) |
| **总耗时** | **145 秒** (2.4 分钟) |
| **处理单元** | 39 Chunks |
| **提取题目数** | **851** |

### 2.2. 缺陷修复验证

| 缺陷 (v1.5 报告) | 修复方式 | 验证结果 |
| :--- | :--- | :--- |
| **P0: API 超时单位错误** | `extraction.ts`: `timeout: config.timeout * 1000` | ✅ **已修复**。API 调用成功，任务正常执行。 |
| **P0: 串行执行性能低下** | `extraction.ts`: `for...of` -> `Promise.all` | ✅ **已修复**。日志时间戳证实并发数为 8，性能提升 **6.4 倍**。 |

**并发性能验证**：

通过分析数据库中的任务日志时间戳，可以清晰地看到并发修复的效果。修复前，各 Chunk 任务串行启动，间隔数十秒；修复后，8 个任务在同一秒内同时启动，符合 `maxWorkers=8` 的配置。

| 运行模式 | 39 Chunks 耗时 | 加速比 |
| :--- | :--- | :--- |
| **串行 (估算)** | ~932 秒 (15.5 分钟) | 1x |
| **并发 (实际)** | **145 秒 (2.4 分钟)** | **6.4x** |

---

## 3. 新发现的问题与改进建议

在对 851 道题目的输出进行深入分析后，我们识别出以下 7 个主要问题，按修复优先级排序：

| ID | 优先级 | 问题类别 | 问题描述与分析 |
| :--- | :--- | :--- | :--- |
| **BUG-1** | <font color="red">**P0 - 阻塞**</font> | **数据库更新** | **`extractedCount` 未更新**：任务完成后，数据库 `extraction_tasks` 表的 `extractedCount` 字段仍为 0，未更新为实际提取的 851。这会导致前端无法正确展示任务成果。**根因**：`taskProcessor.ts` 中 `updateExtractionTask` 调用未包含 `extractedCount` 字段。 |
| **BUG-2** | <font color="red">**P1 - 严重**</font> | **Git 配置** | **LLM 日志被忽略**：`.gitignore` 文件中的 `logs` 规则导致所有 `logs` 目录（包含 LLM 原始输出）均未被提交。这严重阻碍了调试和对 LLM 输出的分析。 |
| **SYS-1** | <font color="red">**P1 - 严重**</font> | **路径可移植性** | **图片路径为绝对路径**：输出的 JSON 和 Markdown 中，图片路径为服务器本地绝对路径 (`/home/home_dev/...`)。这导致在任何其他环境中图片都无法显示，降低了产物的可用性。应改为相对路径。 |
| **QTY-1** | <font color="orange">**P2 - 中等**</font> | **章节标题清洗** | **章节标题存在大量噪声**：851 题中有 365 题的章节标题为“基础训练”、“拓展训练”等通用术语，而非有意义的章节名。**根因**：当前的黑名单机制 (`cleanChapterTitles`) 未能有效清洗。**对齐 DataFlow**：官方 `refine_title` 算子通过正则表达式提取数字编号（如 `19.2`），鲁棒性更高。 |
| **QTY-2** | <font color="orange">**P2 - 中等**</font> | **题目去重** | **跨 Chunk 题目重复**：当前去重逻辑 (`deduplicateQuestions`) 存在漏洞，分析发现 7 组题目在输出中完全重复。**根因**：去重仅基于 `questionIds`，对于分布在不同 Chunk 的相同题目无效。**对齐 DataFlow**：官方 `qa_merger` 基于 `(chapter_title, label)` 复合键进行去重，更为可靠。 |
| **QTY-3** | <font color="orange">**P2 - 中等**</font> | **子题拆分** | **子题被错误拆分**：带有 `(1)`, `(2)` 编号的子题被当作独立的题目提取，脱离了父题干的上下文。例如 Page 22 的一道题被拆分成了 17 个独立的短句。 |
| **QTY-4** | <font color="blue">**P3 - 一般**</font> | **答案覆盖率** | **答案提取率低**：851 道题中仅有 85 道题 (10%) 提取出了答案。**对齐 DataFlow**：官方流水线将“题目抽取”和“答案抽取”作为两个独立的并行步骤，最后通过 `qa_merger` 算子进行合并，这显著提高了答案的覆盖率。 |

---

## 4. 建议的后续步骤

1.  **立即修复 (Immediate Fixes)**:
    *   **修复 BUG-1**: 在 `taskProcessor.ts` 的 `updateExtractionTask` 调用中增加 `extractedCount: questions.length`。
    *   **修复 BUG-2**: 修改 `.gitignore`，将 `logs` 规则限定得更具体，例如改为 `**/logs/` 或在需要时使用 `git add -f` 强制添加。
    *   **修复 SYS-1**: 修改 `exportToJSON` 和 `exportToMarkdown`，将图片路径从绝对路径转换为相对于 `results` 目录的相对路径。

2.  **短期优化 (Short-term Sprints)**:
    *   **对齐 QTY-1 (章节标题)**: 参考 DataFlow 的 `refine_title`，重构 `cleanChapterTitles` 函数，优先使用正则表达式提取数字章节号，作为黑名单策略的补充或替代。
    *   **对齐 QTY-2 (去重)**: 重构 `deduplicateQuestions` 函数，在内存中维护一个 `Set`，键为 `chapter_title` 和 `label` 的组合，以实现更可靠的跨 Chunk 去重。

3.  **中期重构 (Mid-term Refactoring)**:
    *   **探索 QTY-4 (答案覆盖率)**: 考虑将当前单一的抽取流程重构为与 DataFlow 类似的“题目抽取 -> 答案抽取 -> 问答合并”三阶段流水线，以从根本上提升答案的覆盖率和准确性。这需要更系统的设计与重构，但对提升最终产出质量至关重要。

通过以上步骤，项目不仅能巩固当前的成功，还能在数据质量和系统鲁棒性上向官方最佳实践看齐，实现更高水平的稳定产出。
