# 项目说明文档

## 1. 项目规划
**项目名称**: Mineru2Questions
**当前版本**: v9.1 (集成双 LLM 流水线)
**最后更新**: 2026-02-12
**目标**: 提供高质量、ID-Only 的教育题目提取引擎。

### 里程碑
- [x] **v1.0**: 初始版本，完成基本提取功能。
- [x] **v1.1**: 修复 Critical Bugs，增强鲁棒性。
- [x] **v1.2**: 重点修复前端性能与后端进度追踪问题。
- [x] **v9.1**: 集成双 LLM 流水线（章节预处理 + 题目抽取），实现端到端数据流。

## 2. 实施方案
### 技术栈
- **后端**: TypeScript + Node.js (Express)
- **前端**: React + Vite + TailwindCSS
- **数据库**: SQLite (Drizzle ORM)
- **AI**: OpenAI API (ID-Only Output)

### 核心策略
- **本地优先**: 结果文件存储在本地文件系统，数据库仅作索引。
- **ID-Only**: 严格限制 LLM 输出 ID，保证文本一致性。
- **分块并行**: 大文件切片并行处理，保留顺序。

## 3. 进度记录

| 日期 | 任务类型 | 任务内容 | 状态 | 结果说明 |
| :--- | :--- | :--- | :--- | :--- |
| 2026-02-11 | Bug修复 | 修复进度条回跳问题 | 已完成 | 后端增加 `completedChunks` 计数，确保进度单调递增。 |
| 2026-02-11 | Bug修复 | 修复统计数据虚高 | 已完成 | 优化日志关键字，区分 LLM 响应与 Chunk 完成，修正前端统计逻辑。 |
| 2026-02-11 | 性能优化 | 优化结果预览性能 | 已完成 | 增加预览分页机制，解决大文件渲染导致页面假死问题。 |
| 2026-02-11 | Bug修复 | 修复 React Hook 顺序错误 | 已完成 | 修正 `TaskDetail.tsx` 中 `useMemo` 的调用位置。 |
| 2026-02-11 | 版本发布 | 代码同步 GitHub 并打标 v1.2 | 已完成 | 代码已推送到远程仓库，并标记 tag `v1.2`。 |
| 2026-02-12 | 功能集成 | 集成 v9.1 双 LLM 流水线 | 已完成 | 引入 `chapterPreprocess.ts`，升级数据库 schema，实现端到端章节与题目抽取解耦。 |
| 2026-02-17 | 功能优化 | 解析器超长公式回填截断 | 已完成 | 增加超长公式截断逻辑，避免回填结果过长影响可读性。 |
| 2026-02-17 | 回归验证 | 重新跑 Task 1 与 Task 2 | 已完成 | 运行 `npx tsx server/testChapterV2.ts`，输出章节目录树与覆盖率结果。 |
| 2026-02-17 | 逻辑验证 | 章节融合降级逻辑核对 | 已完成 | 核对章节融合分支与回退条件，确保预处理缺失时使用抽取侧标题。 |
| 2026-02-18 | PRD对齐 | 修复 ChapterMerge 标题校验与融合策略 | 已完成 | 修正标题校验正则，移除对 `>` 的误判，并在章节融合时优先采用预处理路径式标题，仅在预处理无效时回退到 LLM 标题。 |
| 2026-02-18 | 架构增强 | 为 ChapterPreprocessV2 增加 ChapterValidation | 已完成 | 在 `preprocessChaptersV2` 中新增目录树验证步骤，基于层级比例与 block 范围检查异常结果，必要时返回空目录以触发下游优雅降级。 |
| 2026-02-20 | 清理规范 | 系统性清理与文档归档 | 已完成 | 清理测试数据与脚本，归档迁移与文档，完成类型检查/单测/构建与未使用项扫描。 |
